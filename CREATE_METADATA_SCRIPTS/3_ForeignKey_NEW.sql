WITH X AS (SELECT AC1.TABLE_NAME, ac1.constraint_name, LTRIM (RTRIM (REPLACE (REPLACE (REPLACE (DBMS_LOB.SUBSTR (DBMS_METADATA.get_ddl ('REF_CONSTRAINT', ac1.constraint_name), 4000, 1), '"' || (SELECT SYS_CONTEXT ('userenv', 'current_schema') x FROM DUAL) || '".', ''), '"', ''), CHR (10), ''))) DDLTXT, LISTAGG (col1.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY col1.POSITION ASC) COLS FROM USER_constraints ac1 JOIN USER_constraints ac2 ON ac1.r_owner = ac2.owner AND ac1.r_constraint_name = ac2.constraint_name JOIN USER_CONS_COLUMNS col1 ON col1.constraint_name = ac1.constraint_name WHERE ac1.table_name LIKE UPPER ('&&tableprefix') || '%' AND ac1.constraint_type = 'R' GROUP BY AC1.TABLE_NAME, ac1.constraint_name) SELECT 'DECLARE ' || 'BEGIN IF (CHK_CNSTR_WITH_COLS (''' || constraint_name || ''',''' || table_name || ''', ''' || cols || ''') <= 0) THEN ' || 'EXECUTE IMMEDIATE ''' || DDLTXT || '''; END IF; END; ~~' CREATESCRIPT FROM X