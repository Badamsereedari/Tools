WITH XT AS (  SELECT tc.table_name, tc.column_name, tc.COLUMN_ID, RTRIM (data_type) || RTRIM ( DECODE ( data_type, 'DATE', NULL, 'LONG', NULL, 'NUMBER', DECODE (TO_CHAR (data_precision), NULL, NULL, '('), '(')) || RTRIM ( DECODE ( data_type, 'DATE', NULL, 'CHAR', data_length, 'VARCHAR2', data_length, 'NUMBER', DECODE ( TO_CHAR (data_precision), NULL, NULL, TO_CHAR (data_precision) || ',' || TO_CHAR (data_scale)), 'LONG', NULL, '******ERROR')) || RTRIM ( DECODE ( data_type, 'DATE', NULL, 'LONG', NULL, 'NUMBER', DECODE (TO_CHAR (data_precision), NULL, NULL, ')'), ')')) datatype, RTRIM (DECODE (nullable, 'N', ' NOT NULL', NULL)) NULLABLE, LONG_TO_CHAR ('USER_TAB_COLUMNS', 'DATA_DEFAULT', tc.column_name, tc.table_name) DATA_DEFAULT FROM USER_tab_columns tc, USER_objects o WHERE  tc.table_name LIKE UPPER ('&&tableprefix') || '%' AND o.object_name = tc.table_name ORDER BY tc.table_name, TC.COLUMN_ID) SELECT 'DECLARE BEGIN IF (CHK_COL(''' || TABLE_NAME || ''',''' || COLUMN_NAME || ''') <= 0) THEN EXECUTE IMMEDIATE ''ALTER TABLE ' || TABLE_NAME || ' ADD ' || COLUMN_NAME || ' ' || datatype || ' ' || DECODE ( DATA_DEFAULT, NULL, NULL, ' DEFAULT ' || CASE WHEN INSTR (datatype, 'VARCHAR') > 0 THEN '''' || SUBSTR(DATA_DEFAULT, 0, LENGTH(DATA_DEFAULT) - 1) || '''' ELSE DATA_DEFAULT END) || NULLABLE || '''; END IF;' || 'END;' || '~~' AS CREATESCRIPT  FROM XT ORDER BY TABLE_NAME, COLUMN_ID